<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Computing functional diversity indices and community weghted means for macroinvertebrates. • fwtraits</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computing functional diversity indices and community weghted means for macroinvertebrates.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fwtraits</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_for_taxa_groups.html">Retrieve data for taxomomic groups.</a></li>
    <li><a class="dropdown-item" href="../articles/fishcompute.html">Computing functional diversity indices and community weighted means for fishes.</a></li>
    <li><a class="dropdown-item" href="../articles/functiondendo.html">Compute functional dendogram from the ecological parameters.</a></li>
    <li><a class="dropdown-item" href="../articles/macroinverts.html">Computing functional diversity indices and community weghted means for macroinvertebrates.</a></li>
    <li><a class="dropdown-item" href="../articles/Secure_API_key.html">How to handle the API key in public and private codes.</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AnthonyBasooma/fwtraits/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Computing functional diversity indices and community weghted means for macroinvertebrates.</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AnthonyBasooma/fwtraits/blob/master/vignettes/macroinverts.Rmd" class="external-link"><code>vignettes/macroinverts.Rmd</code></a></small>
      <div class="d-none name"><code>macroinverts.Rmd</code></div>
    </div>

    
    
<p>The <strong>fwtraits</strong> access the freshwaterecology.info
database that contains several ecological parameters, traits and
indicators used in biogeographical modeling, fuunctional diversity and
taxonomic assessments, and ecological monitoring. These are grouped
based on the taxonomic groups, including macroinvertebrates, fishes,
phytoplankton, phytobenthos, and macrophytes. Therefore, in this
workflow we demonstrated the use of ecological parameters from the
database in assessing functional diversity.</p>
<p><strong>NOTE</strong></p>
<ul>
<li>We demonstrated using simulated the datasets to illustrate the use
of the package and thus no ecological conclusions can be derived from
the analysis.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AnthonyBasooma/fwtraits" class="external-link">fwtraits</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="simulate-the-data-used-in-the-analysis">Simulate the data used in the analysis<a class="anchor" aria-label="anchor" href="#simulate-the-data-used-in-the-analysis"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1135</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sites1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">10</span>, <span class="fl">8</span>, <span class="fl">13</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Margaritifera margaritifera"</span>,<span class="st">"Pseudunio auricularius"</span>,<span class="st">"Musculium lacustre"</span>,</span>
<span>        <span class="st">"Musculium transversum"</span>,<span class="st">"Corbicula fluminea"</span>,<span class="st">"Congeria leucophaeata"</span>,</span>
<span>        <span class="st">"Dreissena polymorpha"</span>, <span class="st">"Dreissena rostriformis bugensis"</span>,</span>
<span>        <span class="st">"Parastenocaris germaica"</span>, <span class="st">"Branchiobdella balcanica"</span>,</span>
<span>        <span class="st">"Branchiobdella hexadonta"</span>,<span class="st">"Branchiobdella parasita"</span>,<span class="st">"Branchiobdella pentadonta"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">mv</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">mv</span>, <span class="fl">10</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">mv</span>, <span class="fl">8</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">mv</span>, <span class="fl">13</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">mv</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">abun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span>, <span class="fl">1.3</span>, <span class="fl">0.12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">macrodf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sites <span class="op">=</span> <span class="va">sites1</span>, species <span class="op">=</span> <span class="va">sp</span>, abund <span class="op">=</span> <span class="va">abun</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieving-the-ecological-parameters-from-the-database">Retrieving the ecological parameters from the database<a class="anchor" aria-label="anchor" href="#retrieving-the-ecological-parameters-from-the-database"></a>
</h3>
<p>We considered two ecological references for macroinvertebrate
species: stream zonation preference and feeding type. These were
selected because most species have records, reducing missing values that
might have required imputation.</p>
<p>It should be noted that imputing for missing traits is outside the
scope of this package. So, species that do not have records were dropped
when computing the functional diversity indices or community weighted
means.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traitsdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fw_fetchdata.html">fw_fetchdata</a></span><span class="op">(</span>data <span class="op">=</span>  <span class="va">macrodf</span>,</span>
<span>                           organismgroup <span class="op">=</span> <span class="st">'mi'</span>,</span>
<span>                           taxonomic_column <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                           ecoparams <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stream zonation preference"</span>, <span class="st">"feeding type"</span><span class="op">)</span>,</span>
<span>                           inform <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="compute-functional-diversity-indices">1. Compute functional diversity indices<a class="anchor" aria-label="anchor" href="#compute-functional-diversity-indices"></a>
</h4>
<p>These are computed by setting
<strong><code>FD to TRUE</code></strong> and <strong>abund</strong>
parameter must be provided. They the indices are computed using the
<strong>FD</strong> package (Laliberté &amp; Legendre 2010). The indices
tested included Functional richness (FRic), species richness (SRic),
Functional evenness (FEve), Functional diversity (FDiv), Funtional
dispersion (FDis), and Rao quotient (Rao Q).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#fd indices calculated when abundance  is provided.</span></span>
<span></span>
<span><span class="va">fdindices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fw_fdcompute.html">fw_fdcompute</a></span><span class="op">(</span>fwdata <span class="op">=</span> <span class="va">traitsdf</span>, </span>
<span>                        sitesdata <span class="op">=</span> <span class="va">macrodf</span>,</span>
<span>                        sites <span class="op">=</span> <span class="st">'sites'</span>,</span>
<span>                        species <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                        abund <span class="op">=</span> <span class="st">'abund'</span>,</span>
<span>                        FD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#functional richness only: when abundance is not provided.</span></span>
<span><span class="va">fdric</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/fw_fdcompute.html">fw_fdcompute</a></span><span class="op">(</span>fwdata <span class="op">=</span> <span class="va">traitsdf</span>, </span>
<span>                        sitesdata <span class="op">=</span> <span class="va">macrodf</span>,</span>
<span>                        sites <span class="op">=</span> <span class="st">'sites'</span>,</span>
<span>                        species <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                        FD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visualisation-of-the-ecological-paramter-for-each-index-">Visualisation of the ecological paramter for each index.<a class="anchor" aria-label="anchor" href="#visualisation-of-the-ecological-paramter-for-each-index-"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">fdindices</span> <span class="op">|&gt;</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="st">'fdind'</span>, <span class="st">"vals"</span>, <span class="op">-</span><span class="va">site</span><span class="op">)</span></span>
<span>                                 </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">vals</span>, fill <span class="op">=</span> <span class="va">fdind</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">fdind</span>, scales <span class="op">=</span><span class="st">'free_y'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">'sites'</span>, y<span class="op">=</span><span class="st">'FD indices'</span><span class="op">)</span></span></code></pre></div>
<p><img src="macroinverts_files/figure-html/viz-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Functional richness</span></span>
<span></span>
<span><span class="va">dffric</span> <span class="op">&lt;-</span> <span class="va">fdric</span> <span class="op">|&gt;</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="st">'fdind'</span>, <span class="st">"vals"</span>, <span class="op">-</span><span class="va">site</span><span class="op">)</span></span>
<span>                                 </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dffric</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">vals</span>, fill <span class="op">=</span> <span class="va">fdind</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">fdind</span>, scales <span class="op">=</span><span class="st">'free_y'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">'Sites'</span>, y<span class="op">=</span><span class="st">'FD indices'</span><span class="op">)</span></span></code></pre></div>
<p><img src="macroinverts_files/figure-html/viz-2.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="compute-community-weighted-means-">1. Compute community weighted means.<a class="anchor" aria-label="anchor" href="#compute-community-weighted-means-"></a>
</h4>
<p>Community weighted means measures how traits vary with environmental
change (Guy-Haim &amp; Bouchet 2025).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwmdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fw_fdcompute.html">fw_fdcompute</a></span><span class="op">(</span>fwdata <span class="op">=</span> <span class="va">traitsdf</span>, </span>
<span>                        sitesdata <span class="op">=</span> <span class="va">macrodf</span>,</span>
<span>                        sites <span class="op">=</span> <span class="st">'sites'</span>,</span>
<span>                        species <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                        abund <span class="op">=</span> <span class="st">'abund'</span>,</span>
<span>                        FD <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="compute-community-weighted-means--1">1. Compute community weighted means.<a class="anchor" aria-label="anchor" href="#compute-community-weighted-means--1"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cwmdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fw_fdcompute.html">fw_fdcompute</a></span><span class="op">(</span>fwdata <span class="op">=</span> <span class="va">traitsdf</span>, </span>
<span>                        sitesdata <span class="op">=</span> <span class="va">macrodf</span>,</span>
<span>                        sites <span class="op">=</span> <span class="st">'sites'</span>,</span>
<span>                        species <span class="op">=</span> <span class="st">'species'</span>,</span>
<span>                        abund <span class="op">=</span> <span class="st">'abund'</span>,</span>
<span>                        FD <span class="op">=</span> <span class="cn">FALSE</span>, dummy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="refereences">Refereences<a class="anchor" aria-label="anchor" href="#refereences"></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Laliberté, E., &amp; Legendre, P. (2010). A distance‐based
framework for measuring functional diversity from multiple traits.
Ecology, 91(1), 299-305.</p></li>
<li><p>Guy-Haim, T., &amp; Bouchet, V. M. (2025). Beyond taxonomy: A
framework for biological trait analysis to assess the functional
structure of benthic foraminiferal communities. Marine Pollution
Bulletin, 213, 117699.</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anthony Basooma, Florian Borgwardt, Thomas Hein, Astrid Schmidt-Kloiber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
