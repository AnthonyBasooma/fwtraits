---
title: "Acessing fish ecological parameters, traits or indicators"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Acessing fish ecological parameters, traits or indicators}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(httr2)
library(fwtraits)
```

**Step 1: Get the before you start page for instructions on how to access the database**.

Its optional to check how the database can be accessed but in step 2, I have created a document on how to set the API key and get the access token automatically.

```{r beforeyoure start procedure}
#fw_be4ustart()
```

**Step 2: Get authentication token using the API key**.

For data to be accessed, the Application Programming Interface Key (API key) must be provided. This is a time key provided during registration or a request to the database managers on registration@freshwaterecology.info for already registered members.
If the key is acquired, please follow  \code{\link{How to handle the API key in public and private codes.}}.



**Step 3: Access the fish traits data**

* The fish data is easily accessed by identifying the traits needed by the user. To ably get trait spellings, the user is strongly advised to run **`fw_dbguide()`** function and filter out the organism groups. The trait names can be copied and pasted in the **`ecoparams`** parameter of the function.
* Multiple species can be set as indicated below but also multiple species in a dataframe of vector of names in acceptable.
* Ensure that right species names are indicated to avoid detailed checks that delays data search and might lead to erroneous trait extraction or errors. Checks are conducted on the species names to ensure they are harmonized to trait searches. However, these checks have operational overheads in data searches.

```{r access species ecological traits}

#One species 
migration <- fw_fetchdata(data = "Abramis brama", organismgroup = 'fi',
                          ecoparams = 'migration',
                          cachefolder = 'cache',
                          inform = TRUE)

#For multiple species, the species column should be provided.
#For detailed understanding of the function, run ?fw_fetchdata

data("speciesdata") #data archived in fwtraits

fishtraits <- fw_fetchdata(data = speciesdata, 
                           organismgroup = 'fi',
                           spcol = 'scientificName', 
                           ecoparams = c('migration', 'threat austria',
                                         'oxygen tolerence', 'migration fibs'),
                           seed = 1123,
                           sanitize = TRUE,
                           cachefolder  = 'cache',
                           inform = TRUE)
head(fishtraits)

```

**step 4: Post data searches: visualizing traits fetched from the database.**

If the species considered are more than 1, then visualization can be to determine the frequency of each trait. This is an optional function for post data searches.

```{r viszualize outputs, fig.width = 6, fig.height= 5, fig.align='center'}

# fw_visualize(output = fishtraits, params = 'migration')
# 
# fw_visualize(output = fishtraits, params = 'migration fibs')

```


**References**
* Schmidt-Kloiber, A., & Hering, D. (2015). www.freshwaterecology.info - An online tool that unifies, standardises and codifies more than 20,000 European freshwater organisms and their ecological preferences. Ecological Indicators, 53, 271-282. https://doi.org/10.1016/j.ecolind.2015.02.007





