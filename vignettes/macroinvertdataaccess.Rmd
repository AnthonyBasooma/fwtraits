---
title: "Acessing macroinvertebrates data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Acessing macroinvertebrates data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(fwtraits)
```


###Step 1: Get the before you start page for instructions on how to access the database.

Please follow the secure_the_api_key to identify how the API is secured in the user R environment before retrieving the species traits.


###Step3: Access the macroinvertebrates traits data

* The macroinvertebrates data is easily accessed by identifying the species traits needed by the user. To ably get trait spellings, the user is strongly advised to run **`fw_dbguide()`** function and filter out the organism groups. The trait names can be copied and pasted in the **`ecoparams`** parameter of the function.
* Multiple species can be set as indicated below but also multiple species in a dataframe of vector of names in acceptable.
* Ensure that right species names are indicated to avoid detailed checks that delays data search and might lead to erroneous trait extraction or errors. Checks are conducted on the species names to ensure they are harmonized to trait searches. However, these checks have operational overheads in data searches.

*1. Access single species name.*

```{r access single species name}

#One species 
mmdata_traits <- fw_fetchdata(data =  "Margaritifera margaritifera",
                                        organismgroup = 'mi',
                                        ecoparams = c('stream zonation preference'),
                                        inform = TRUE,
                                        cachefolder = 'cache')
```

*2. Accsess more than one species in a list*

```{r species names in alist or vector}

specieslist <- c("Margaritifera margaritifera",
                 "Pseudunio auricularius",
                 "Musculium lacustre",
                 "Musculium transversum",
                 "Parastenocaris germanica")

multspp <- fw_fetchdata(data =  specieslist,
                        organismgroup = 'mi',
                        ecoparams = c('stream zonation preference'),
                        inform = TRUE,
                        sanitize = TRUE,
                        cachefolder = 'cache')

```

*3 Species names accessed in a data frame*

```{r species names in a dataframe not list or vector}

macrodf <- data.frame(organismgroup = rep('mi', 5),
                      species = c("Margaritifera margaritifera",
                 "Pseudunio auricularius",
                 "Musculium lacustre",
                 "Musculium transversum",
                 "Parastenocaris germaica"))

multspp_df <- fw_fetchdata(data =  macrodf,
                                     organismgroup = 'mi',
                                     spcol = 'species',
                                     ecoparams = c('stream zonation preference'),
                                     inform = TRUE,
                                     sanitize = TRUE,
                                     cachefolder = 'cache')

```


**Post data searches: visualizing traits fetched from the database.**

If the species considered are more than 1, then visualization can be to determine the frequency of each trait. This is an optional function for post data searches.

```{r viszualize outputs, fig.width = 6, fig.height= 5, fig.align='center'}

#fw_visualize(foutput = mmdata_traits)# not necessary since its one species

# fw_visualize(output = multspp)
# 
# fw_visualize(output = multspp_df)

```

**References**
* Schmidt-Kloiber, A., & Hering, D. (2015). www.freshwaterecology.info - An online tool that unifies, standardises and codifies more than 20,000 European freshwater organisms and their ecological preferences. Ecological Indicators, 53, 271-282. https://doi.org/10.1016/j.ecolind.2015.02.007

