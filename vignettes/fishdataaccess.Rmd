---
title: "Acessing fish ecological parameters, traits or indicators"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Acessing fish ecological parameters, traits or indicators}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(httr2)
library(fwtraits)
```

**Step 1: Get the before you start page for instructions on how to access the database**.

To ably set the API key and obtain the token, check the secure_api_key.html vignettes. Briefly, they are two ways to set the API key: 1) in private user codes and 2) public/shared codes. Since in the vignettes the codes are shared, the API key willl be encryted and decrypted on querying the database.

```{r beforeyoure start procedure}
#fw_be4ustart()
```

**Step 2: Get authentication token using the API key**.

```{r generate token}

#please check secure_api page to learn how to secure the API key

enc_api <- "p6-9gAvYXveyC_B_0hTzyYl5FwLRwZEPD-ZE9Y4KrIBstgNc8K2Mr4u6t39LGZ2E1m9SOw"

#download fish catchment region data

apikeydecrypted <- fw_loadapikey(test = TRUE, sacrambled_apikey = enc_api,
                              fwtraitskey =  'FWTRAITS_KEY')

tokendata <- fw_token(apikey= apikeydecrypted, seed = 1234, cachepath = 'cache')

```

**Access the fish traits data**

```{r access species ecological traits}

#One species 


migration <- fw_fetchdata(data = "Abramis brama", organismgroup = 'fi',
                          ecoparams = 'migration', 
                          token = tokendata,
                          cachepath = 'cache',
                          inform = TRUE)



data("speciesdata") #data archived in fwtraits

fishtraits <- fw_fetchdata(data = speciesdata, 
                           organismgroup = 'fi', 
                           token = tokendata,
                           spcol = 'scientificName', 
                           ecoparams = c('migration', 'threat austria',
                                         'oxygen tolerence', 'migration fibs'),
                           sanitize = TRUE,
                           cachepath = 'cache',
                           inform = TRUE)

```

**Visualize**

```{r viszualize outputs, fig.width = 6, fig.height= 5, fig.align='center'}

fw_visualize(output = fishtraits, params = 'migration')

fw_visualize(output = fishtraits, params = 'migration fibs')

```


**References**
* Schmidt-Kloiber, A., & Hering, D. (2015). www.freshwaterecology.info - An online tool that unifies, standardises and codifies more than 20,000 European freshwater organisms and their ecological preferences. Ecological Indicators, 53, 271-282. https://doi.org/10.1016/j.ecolind.2015.02.007





